<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ReadZone - Бронирование читального зала</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    * {margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .container{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:20px;padding:40px;box-shadow:0 20px 40px rgba(0,0,0,.1);width:100%;max-width:650px;text-align:center}
    h1{color:#333;margin-bottom:10px;font-size:2rem;font-weight:600}
    .subtitle{color:#666;margin-bottom:30px;font-size:.9rem}
    .form-group{margin-bottom:20px;text-align:left}
    label{display:block;margin-bottom:8px;color:#555;font-weight:500;font-size:.9rem}
    input,select,textarea{width:100%;padding:12px;border:2px solid #e1e5e9;border-radius:12px;font-size:16px;background:white}
    .date-time-group{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .btn{width:100%;padding:12px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;border-radius:12px;font-weight:600;cursor:pointer;margin-top:10px}
    .btn-secondary{background:#6c757d}
    .auth-card,.booking-card,.password-reset-card,.settings-card{display:none}
    .auth-card.active,.booking-card.active,.password-reset-card.active,.settings-card.active{display:block}
    .bookings-list{margin-top:20px;text-align:left}
    .booking-item{background:#f8f9fa;padding:12px;border-radius:10px;margin-bottom:10px;border-left:4px solid #667eea;cursor:pointer}
    .booking-time{font-weight:600;color:#333}
    .booking-duration{color:#666;font-size:.9rem}
    .booking-comment{font-size:.9rem;color:#444;margin-top:5px;font-style:italic;white-space:pre-wrap}
    .error{color:#dc3545;font-size:.9rem;margin-top:5px}
    .success{color:#28a745;font-size:.9rem;margin-top:5px}
    .room-info{background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%);padding:16px;border-radius:12px;margin-bottom:20px;text-align:left}
    .room-title{font-size:1.1rem;font-weight:600;color:#333;margin-bottom:4px}
    .info-text{color:#555;font-size:.9rem;margin-top:-8px;margin-bottom:16px;text-align:left}
    .modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.4);justify-content:center;align-items:center}
    .modal-content{background:#fff;padding:16px;border-radius:10px;width:90%;max-width:420px;position:relative}
    .close-btn{position:absolute;right:12px;top:6px;font-size:22px;cursor:pointer}
    .checkbox-container{display:block;position:relative;padding-left:35px;margin-bottom:10px;cursor:pointer;font-size:.9rem;color:#555;text-align:left}
    .checkbox-container input{position:absolute;opacity:0;cursor:pointer;height:0;width:0}
    .checkmark{position:absolute;left:0;top:0;height:22px;width:22px;background:#eee;border-radius:6px}
    .checkbox-container input:checked ~ .checkmark{background:#667eea}
    .checkmark:after{content:"";position:absolute;display:none}
    .checkbox-container input:checked ~ .checkmark:after{display:block}
    .checkbox-container .checkmark:after{left:8px;top:4px;width:6px;height:12px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg)}
    .privacy-options {display:flex;gap:15px;margin:10px 0}
    .privacy-option label{display:flex;align-items:center;gap:5px;cursor:pointer}
    .privacy-option input[type="radio"]{width:auto}
    .modal-delete-btn{background:#dc3545;color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;margin-top:10px}
  </style>
</head>
<body>
  <div class="container">
    <h1>ReadZoneBookings</h1>
    <p class="subtitle">Бронирование читального зала</p>

    <!-- === AUTH === -->
    <div class="auth-card active" id="authCard">
      <div class="form-group"><label for="name">Ваше имя</label><input type="text" id="name" placeholder="Бердалы Лейла"></div>
      <div class="form-group"><label for="email">Email</label><input type="email" id="email" placeholder="you@example.com"></div>
      <div class="form-group"><label for="password">Пароль</label><input type="password" id="password" placeholder="Минимум 6 символов"></div>
      <button class="btn" id="btnSignIn">Войти</button>
      <button class="btn btn-secondary" id="btnSignUp">Зарегистрироваться</button>
      <button class="btn btn-secondary" id="btnResetShow">Сброс пароля</button>
      <div id="authMessage"></div>
    </div>

    <!-- === RESET === -->
    <div class="password-reset-card" id="passwordResetCard">
      <h2>Сброс пароля</h2>
      <div class="form-group"><label for="resetEmail">Email</label><input type="email" id="resetEmail" placeholder="you@example.com"></div>
      <button class="btn" id="btnReset">Отправить письмо</button>
      <button class="btn btn-secondary" id="btnBackToAuth">Вернуться ко входу</button>
      <div id="resetMessage"></div>
    </div>

    <!-- === SETTINGS === -->
    <div class="settings-card" id="settingsCard">
      <h2>Настройки аккаунта</h2>
      <div class="form-group"><label for="settingsName">Имя</label><input type="text" id="settingsName" placeholder="Ваше имя"></div>
      <div class="form-group"><label for="settingsEmail">Email</label><input type="email" id="settingsEmail" disabled><small>Email нельзя изменить</small></div>
      <div class="form-group"><label for="newPassword">Новый пароль</label><input type="password" id="newPassword"></div>
      <div class="form-group"><label for="confirmPassword">Подтвердите пароль</label><input type="password" id="confirmPassword"></div>
      <div class="form-group">
        <label>Что показывать другим в бронях:</label>
        <div class="privacy-options">
          <div class="privacy-option"><input type="radio" id="privacy-name" name="privacy" value="name"><label for="privacy-name">Показывать имя</label></div>
          <div class="privacy-option"><input type="radio" id="privacy-email" name="privacy" value="email"><label for="privacy-email">Показывать email</label></div>
        </div>
      </div>
      <button class="btn" id="btnSaveSettings">Сохранить</button>
      <button class="btn btn-secondary" id="btnBackToBooking">Назад</button>
      <div id="settingsMessage"></div>
    </div>

    <!-- === BOOKING === -->
    <div class="booking-card" id="bookingCard">
      <div class="room-info"><div class="room-title">Читальный зал</div><div class="room-desc">Место для учебы и работы</div></div>
      <div class="form-group"><label for="bookingDate">Дата</label><input type="date" id="bookingDate"></div>
      <div class="form-group date-time-group">
        <div><label for="time-start">Начало</label><input type="time" id="time-start"></div>
        <div><label for="time-end">Конец</label><input type="time" id="time-end"></div>
      </div>
      <p class="info-text">(Максимальная длительность брони: 4 часа)</p>
      <div class="form-group"><label for="bookingComment">Комментарий</label><textarea id="bookingComment" rows="3" placeholder="Цель бронирования"></textarea></div>
      <button class="btn" id="btnCreateBooking">Забронировать</button>
      <button class="btn btn-secondary" id="btnSignOut">Выйти</button>
      <button class="btn btn-secondary" id="btnSettings">Настройки</button>
      <div id="bookingMessage"></div>
      <div class="bookings-list"><h3>Мои брони</h3><div id="bookingsList"></div></div>
      <div class="bookings-list" style="margin-top:20px;"><h3>Все брони</h3><div id="allBookingsList"></div></div>
    </div>
  </div>

  <div id="bookingModal" class="modal"><div class="modal-content"><span class="close-btn">&times;</span><div id="modalInfo"></div></div></div>

<script>
  // Настройка Supabase
  const SUPABASE_URL = 'https://ufdpcktbgazzrqzqxxhf.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR...'; // твой ключ
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // элементы
  const authCard = el('authCard'), bookingCard = el('bookingCard'), passwordResetCard = el('passwordResetCard'), settingsCard = el('settingsCard');
  let currentUser = null;

  function el(id){ return document.getElementById(id); }
  function showMessage(id, text, type='error'){ el(id).innerHTML = `<div class="${type}">${text}</div>`; setTimeout(()=>el(id).innerHTML='',5000); }

  // --- AUTH, SETTINGS, BOOKINGS функции такие же как у тебя ---
  // ...
  // --- DELETE FIX ---
  async function deleteBooking(id){ 
    if(!currentUser){ alert('Нужен вход'); return; } 
    const { error } = await supabase.from('bookings').delete().eq('id', id).eq('user_id', currentUser.id); 
    if(error){ alert('Ошибка удаления: '+error.message); return; } 
    alert('Бронь удалена'); 
    el('bookingModal').style.display='none'; 
    await loadUserBookings(); 
    await loadAllBookings(); 
  }
</script>
</body>
</html>
