<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>ReadZoneBookings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Supabase JS SDK -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gradient-to-br from-indigo-100 to-white min-h-screen flex items-center justify-center">

  <div class="w-full max-w-md bg-white shadow-xl rounded-2xl p-6">
    <h1 class="text-2xl font-bold text-center text-indigo-600 mb-6">ReadZoneBookings</h1>

    <!-- –§–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="auth-section">
      <input id="email" type="email" placeholder="Email" class="w-full mb-3 p-2 border rounded-md">
      <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full mb-3 p-2 border rounded-md">
      <button onclick="signIn()" class="w-full bg-indigo-600 text-white py-2 rounded-md mb-2 hover:bg-indigo-700">–í–æ–π—Ç–∏</button>
      <button onclick="signUp()" class="w-full bg-gray-200 py-2 rounded-md hover:bg-gray-300">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π -->
    <div id="booking-section" class="hidden">
      <p class="text-gray-600 mb-3">–ü—Ä–∏–≤–µ—Ç, <span id="user-email"></span> üëã</p>

      <label class="block mb-1 text-sm font-medium">–ö–æ–º–Ω–∞—Ç–∞</label>
      <select id="room" class="w-full mb-3 p-2 border rounded-md">
        <option value="Room A">–ö–æ–º–Ω–∞—Ç–∞ A</option>
        <option value="Room B">–ö–æ–º–Ω–∞—Ç–∞ B</option>
      </select>

      <label class="block mb-1 text-sm font-medium">–î–∞—Ç–∞</label>
      <input id="date" type="date" class="w-full mb-3 p-2 border rounded-md">

      <label class="block mb-1 text-sm font-medium">–í—Ä–µ–º—è (–º–∞–∫—Å. 4 —á–∞—Å–∞)</label>
      <input id="time-start" type="time" class="w-full mb-3 p-2 border rounded-md">
      <input id="time-end" type="time" class="w-full mb-3 p-2 border rounded-md">

      <button onclick="bookRoom()" class="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
      <button onclick="signOut()" class="w-full mt-3 bg-red-500 text-white py-2 rounded-md hover:bg-red-600">–í—ã–π—Ç–∏</button>

      <h2 class="text-lg font-semibold mt-6 mb-2">üìÖ –í–∞—à–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</h2>
      <ul id="bookings-list" class="space-y-2 text-sm text-gray-700"></ul>
    </div>
  </div>

  <script>
    // === –í–°–¢–ê–í–¨ –°–í–û–ò –ó–ù–ê–ß–ï–ù–ò–Ø ===
    const SUPABASE_URL = "https://ufdpcktbgazzrqzqxxhf.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVmZHBja3RiZ2F6enJxenF4eGhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1Mjc4MzIsImV4cCI6MjA3NDEwMzgzMn0.GT3YDB3pKZyDqTX-I3dkZQb4xpWP8xK9bhMgFnaZhsM";
    const supabase = supabasejs.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    async function signUp() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      let { error } = await supabase.auth.signUp({ email, password });
      if (error) alert(error.message); else alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!");
    }

    async function signIn() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      let { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) alert(error.message); else {
        document.getElementById("auth-section").classList.add("hidden");
        document.getElementById("booking-section").classList.remove("hidden");
        document.getElementById("user-email").textContent = data.user.email;
        loadBookings();
      }
    }

    async function signOut() {
      await supabase.auth.signOut();
      document.getElementById("auth-section").classList.remove("hidden");
      document.getElementById("booking-section").classList.add("hidden");
    }

    // –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    async function bookRoom() {
      const user = (await supabase.auth.getUser()).data.user;
      const room = document.getElementById("room").value;
      const date = document.getElementById("date").value;
      const start = document.getElementById("time-start").value;
      const end = document.getElementById("time-end").value;

      if (!date || !start || !end) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!");
      let { error } = await supabase.from("bookings").insert({
        user_id: user.id,
        user_email: user.email,
        room: room,
        start: new Date(`${date}T${start}`),
        end: new Date(`${date}T${end}`)
      });
      if (error) alert(error.message); else loadBookings();
    }

    async function loadBookings() {
      const user = (await supabase.auth.getUser()).data.user;
      let { data, error } = await supabase.from("bookings")
        .select("*")
        .eq("user_id", user.id)
        .order("start", { ascending: true });
      if (error) return console.log(error);

      let list = document.getElementById("bookings-list");
      list.innerHTML = "";
      data.forEach(b => {
        list.innerHTML += `<li>üìñ ${b.room} ‚Äî ${new Date(b.start).toLocaleString()} ‚Üí ${new Date(b.end).toLocaleString()}</li>`;
      });
    }
  </script>
</body>
</html>
