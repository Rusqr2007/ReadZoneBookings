<!-- profile.html -->
<!doctype html>
<html lang="ru">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Профиль — Мои брони</title>
<style>body{font-family:system-ui;padding:22px;background:#f6f8fb} .card{background:#fff;padding:18px;border-radius:12px;max-width:720px;box-shadow:0 10px 30px rgba(0,0,0,.05)}</style>
</head>
<body>
<div class="card">
  <h2>Мои брони</h2>
  <div id="info">Загрузка...</div>
  <div id="bookings"></div>
  <div style="margin-top:12px"><a href="/">Вернуться на главную</a></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
const SUPABASE_URL = "https://YOUR_SUPABASE_URL.supabase.co"; // <- замени
const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY"; // <- замени
const supabase = supabasejs.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

async function load(){
  const { data: { user } } = await supabase.auth.getUser();
  if(!user){ location.href = '/'; return; }
  document.getElementById('info').innerHTML = `<b>${user.email}</b> (id: ${user.id}) <button id="logout">Выйти</button>`;
  document.getElementById('logout').onclick = async ()=>{ await supabase.auth.signOut(); location.href='/'; };
  // получить брони через function (публично доступно по user_id)
  const res = await fetch('/.netlify/functions/list-bookings?user_id=' + encodeURIComponent(user.id));
  const arr = await res.json();
  if(!arr || arr.length===0) { document.getElementById('bookings').innerHTML = '<div class="muted">Броней нет</div>'; return; }
  document.getElementById('bookings').innerHTML = arr.map(b=>{
    return `<div style="padding:8px;border:1px solid #eee;border-radius:8px;margin-bottom:8px">
      <b>${b.room}</b><div style="color:#666">${new Date(b.start).toLocaleString()} — ${new Date(b.end).toLocaleString()}</div>
    </div>`;
  }).join('');
}
load();
</script>
</body>
</html>
